<?xml version="1.0" encoding="UTF-8"?>
<odoo>

  <!-- Inherit Form View: Add Retailer PO fields -->
  <record id="view_sale_order_form_dc" model="ir.ui.view">
    <field name="name">sale.order.form.dc</field>
    <field name="model">sale.order</field>
    <field name="inherit_id" ref="sale.view_order_form"/>
    <field name="arch" type="xml">
      
      <!-- Add DC info after origin -->
      <xpath expr="//field[@name='client_order_ref']" position="after">
        <field name="dc_monitor_id" invisible="1"/>
        <field name="is_from_dc" 
               readonly="1" 
               attrs="{'invisible': [('is_from_dc', '=', False)]}"/>
        <field name="retailer_company_id" 
               readonly="1" 
               attrs="{'invisible': [('retailer_company_id', '=', False)]}"/>
        <field name="retailer_po_id" 
               readonly="1"
               attrs="{'invisible': [('retailer_po_id', '=', False)]}"/>
      </xpath>

      <!-- Add button to view Retailer PO -->
      <xpath expr="//header" position="inside">
        <button name="action_view_retailer_po" 
                type="object" 
                string="View Retailer PO" 
                class="btn-primary"
                attrs="{'invisible': [('retailer_po_id', '=', False)]}"/>
      </xpath>

      <!-- Add smart button for monitor -->
      <xpath expr="//div[@name='button_box']" position="inside">
        <button name="%(distribution_channel.action_dc_monitor)d" 
                type="action" 
                class="oe_stat_button" 
                icon="fa-link"
                attrs="{'invisible': [('dc_monitor_id', '=', False)]}"
                context="{'search_default_dc_so_id': active_id}">
          <div class="o_field_widget o_stat_info">
            <span class="o_stat_text">View</span>
            <span class="o_stat_text">Monitor</span>
          </div>
        </button>
      </xpath>

      <!-- Add notebook page for DC info -->
      <xpath expr="//notebook" position="inside">
        <page name="dc_info" 
              string="DC Information" 
              attrs="{'invisible': [('is_from_dc', '=', False)]}">
          <group>
            <group string="Retailer Details">
              <field name="retailer_company_id" readonly="1"/>
              <field name="retailer_po_id" readonly="1"/>
            </group>
            <group string="DC Info">
              <field name="is_from_dc" readonly="1"/>
            </group>
          </group>
        </page>
      </xpath>

    </field>
  </record>

  <!-- Inherit Tree View: Add auto-created column -->
  <record id="view_sale_order_tree_dc" model="ir.ui.view">
    <field name="name">sale.order.tree.dc</field>
    <field name="model">sale.order</field>
    <field name="inherit_id" ref="sale.view_order_tree"/>
    <field name="arch" type="xml">
      
      <xpath expr="//field[@name='partner_id']" position="after">
        <field name="retailer_company_id" optional="hide"/>
        <field name="is_from_dc" optional="hide"/>
      </xpath>

    </field>
  </record>

  <!-- Inherit Search View: Add DC filters -->
  <record id="view_sale_order_search_dc" model="ir.ui.view">
    <field name="name">sale.order.search.dc</field>
    <field name="model">sale.order</field>
    <field name="inherit_id" ref="sale.view_sales_order_filter"/>
    <field name="arch" type="xml">
      
      <xpath expr="//search" position="inside">
        <filter name="from_dc" 
                string="From DC" 
                domain="[('is_from_dc', '=', True)]"/>
        
        <filter name="with_retailer_po" 
                string="With Retailer PO" 
                domain="[('retailer_po_id', '!=', False)]"/>
        <group expand="0" string="Group By">
          <filter name="group_by_retailer_company" 
                  string="Retailer Company" 
                  context="{'group_by': 'retailer_company_id'}"/>
        </group>
      </xpath>

    </field>
  </record>

</odoo>